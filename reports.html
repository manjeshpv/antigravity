<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment Reports</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 2rem;
            background-color: #f0f2f5;
            color: #333;
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 2rem;
        }

        a {
            display: inline-block;
            margin-bottom: 1rem;
            color: #007bff;
            text-decoration: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 2rem;
        }

        th,
        td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f8f9fa;
            width: 60%;
        }

        td {
            text-align: right;
            font-weight: bold;
        }

        .total-row {
            background-color: #e8f5e9;
            font-size: 1.1em;
        }
    </style>
</head>

<body>
    <div class="container">
        <a href="index.html">&larr; Back to Dashboard</a>
        <h1>Summary Report</h1>

        <table id="reportTable">
            <tbody>
                <tr>
                    <th>Invested Amount (Total SIPs)</th>
                    <td id="investedAmount">--</td>
                </tr>
                <tr>
                    <th>Returns from 5% Account (PP5)</th>
                    <td id="returns5" style="color: green;">--</td>
                </tr>
                <tr>
                    <th>Returns from 10% Account (PP10)</th>
                    <td id="returns10" style="color: green;">--</td>
                </tr>
                <tr>
                    <th>Returns from 15% Account (PP15)</th>
                    <td id="returns15" style="color: green;">--</td>
                </tr>
                <tr class="total-row">
                    <th>Total Returns (by 30 Oct 2026)</th>
                    <td id="totalReturns2026">--</td>
                </tr>
                <tr>
                    <th>Further Returns (Oct 2026 - Mar 2027)</th>
                    <td id="furtherReturns">--</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script src="db.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (!window.db) {
                document.body.innerHTML = '<h1 style="text-align:center">Data not loaded. Run npm run generate.</h1>';
                return;
            }

            const { transactions } = window.db;

            // 1. Invested Amount: Description "SIP Investment" (or "SIP Credit" from enum, mapped to string in generate_data.js)
            // From generate_data.js: TransactionType.SIP_CREDIT = 'SIP Investment'
            const investedAmount = transactions
                .filter(tx => tx.description === 'SIP Investment')
                .reduce((sum, tx) => sum + tx.amount, 0);

            // 2. Returns 5% (PP5): "Interest Income" (Credit to pp5)
            const returns5 = transactions
                .filter(tx => tx.accountId === 'pp5' && tx.description === 'Interest Income' && tx.amount > 0)
                .reduce((sum, tx) => sum + tx.amount, 0);

            // 3. Returns 10% (PP10)
            const returns10 = transactions
                .filter(tx => tx.accountId === 'pp10' && tx.description === 'Interest Income' && tx.amount > 0)
                .reduce((sum, tx) => sum + tx.amount, 0);

            // 4. Returns 15% (PP15)
            const returns15 = transactions
                .filter(tx => tx.accountId === 'pp15' && tx.description === 'Interest Income' && tx.amount > 0)
                .reduce((sum, tx) => sum + tx.amount, 0);

            // 5. Total Returns (by 30 Oct 2026)
            const cutoffDate = new Date('2026-10-30');
            const totalReturns2026 = transactions
                .filter(tx =>
                    tx.description === 'Interest Income' &&
                    tx.amount > 0 &&
                    ['pp5', 'pp10', 'pp15'].includes(tx.accountId) &&
                    new Date(tx.date) <= cutoffDate
                )
                .reduce((sum, tx) => sum + tx.amount, 0);

            // 6. Further Returns (After 30 Oct 2026)
            const furtherReturns = transactions
                .filter(tx =>
                    tx.description === 'Interest Income' &&
                    tx.amount > 0 &&
                    ['pp5', 'pp10', 'pp15'].includes(tx.accountId) &&
                    new Date(tx.date) > cutoffDate
                )
                .reduce((sum, tx) => sum + tx.amount, 0);

            // Update DOM
            const format = (amt) => amt.toLocaleString('en-IN', { style: 'currency', currency: 'INR' });

            document.getElementById('investedAmount').innerText = format(investedAmount);
            document.getElementById('returns5').innerText = format(returns5);
            document.getElementById('returns10').innerText = format(returns10);
            document.getElementById('returns15').innerText = format(returns15);
            document.getElementById('totalReturns2026').innerText = format(totalReturns2026);
            document.getElementById('furtherReturns').innerText = format(furtherReturns);
        });
    </script>
</body>

</html>