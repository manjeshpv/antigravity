<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment Reports</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 2rem;
            background-color: #f0f2f5;
            color: #333;
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 2rem;
        }

        a {
            display: inline-block;
            margin-bottom: 1rem;
            color: #007bff;
            text-decoration: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 2rem;
        }

        th,
        td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f8f9fa;
            width: 60%;
        }

        td {
            text-align: right;
            font-weight: bold;
        }

        .total-row {
            background-color: #e8f5e9;
            font-size: 1.1em;
        }
    </style>
</head>

<body>
    <div class="container">
        <h3>Dashboard</h3>
        <div class="personal-details">
            <span>Name: Manjesh</span>|
            <span>Date of birth: 05 Feb 1989</span>
            <span>Age: <span id="age"></span></span>
        </div>

        <div class="strategy"
            style="background: #e3f2fd; padding: 1rem; margin-top: 1rem; border-radius: 8px; border-left: 5px solid #2196f3; text-align: left;">
            <h3 style="margin-top: 0; color: #1565c0;">Investment Strategy</h3>
            <ul style="margin-bottom: 0; padding-left: 20px; line-height: 1.6;">
                <li><strong>Initial Investment:</strong> Investing 2x amount in Arbitrage Fund (5% Return) via monthly
                    SIPs.</li>
                <li><strong>Secondary Investment:</strong> Investing 1x amount in Conservative Fund (10% Return) via
                    monthly SIPs.</li>
                <li><strong>Reinvestment Flow:</strong>
                    <ul>
                        <li>Payouts from Arbitrage Fund (Monthly) &rarr; Reinvested into Flexi Cap Fund (15% Return).
                        </li>
                        <li>Payouts from Conservative Fund (Annually on Oct 30) &rarr; Reinvested into Flexi Cap Fund
                            (15% Return).</li>
                    </ul>
                </li>
            </ul>
        </div>
        <h1>Summary Report</h1>

        <table id="reportTable">
            <tbody>
                <tr>
                    <th><a href="transactions.html?accountId=sbi">Invested Amount (Total SIPs)</a></th>
                    <td id="investedAmount">--</td>
                </tr>
                <tr>
                    <th><a href="transactions.html?accountId=pp5">Returns from 5% Account (PP5)</a></th>
                    <td id="returns5" style="color: green;">--</td>
                </tr>
                <tr>
                    <th><a href="transactions.html?accountId=pp10">Returns from 10% Account (PP10)</a></th>
                    <td id="returns10" style="color: green;">--</td>
                </tr>
                <tr>
                    <th><a href="transactions.html?accountId=pp15">Returns from 15% Account (PP15)</a></th>
                    <td id="returns15" style="color: green;">--</td>
                </tr>
                <tr class="total-row">
                    <th><a href="breakup.html">Total Returns (by 30 Oct 2026)</a></th>
                    <td id="totalReturns2026">--</td>
                </tr>
                <tr>
                    <th><a href="breakup.html">Further Returns (Oct 2026 - Mar 2027)</a></th>
                    <td id="furtherReturns">--</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script src="db.js"></script>
    <script>
        // Age Calculation (Existing)
        function calculateAge(dob) {
            const diff_ms = Date.now() - dob.getTime();
            const age_dt = new Date(diff_ms);
            return Math.abs(age_dt.getUTCFullYear() - 1970);
        }
        const dob = new Date('1989-02-05');
        document.getElementById('age').innerText = calculateAge(dob);
        document.addEventListener('DOMContentLoaded', () => {
            if (!window.db) {
                document.body.innerHTML = '<h1 style="text-align:center">Data not loaded. Run npm run generate.</h1>';
                return;
            }

            const { transactions } = window.db;

            // 1. Invested Amount: Description "SIP Investment" (or "SIP Credit" from enum, mapped to string in generate_data.js)
            // From generate_data.js: TransactionType.SIP_CREDIT = 'SIP Investment'
            const investedAmount = transactions
                .filter(tx => tx.description === 'SIP Investment')
                .reduce((sum, tx) => sum + tx.amount, 0);

            // 2. Returns 5% (PP5): "Interest Income" (Credit to pp5)
            const returns5 = transactions
                .filter(tx => tx.accountId === 'pp5' && tx.description === 'Interest Income' && tx.amount > 0)
                .reduce((sum, tx) => sum + tx.amount, 0);

            // 3. Returns 10% (PP10)
            const returns10 = transactions
                .filter(tx => tx.accountId === 'pp10' && tx.description === 'Interest Income' && tx.amount > 0)
                .reduce((sum, tx) => sum + tx.amount, 0);

            // 4. Returns 15% (PP15)
            const returns15 = transactions
                .filter(tx => tx.accountId === 'pp15' && tx.description === 'Interest Income' && tx.amount > 0)
                .reduce((sum, tx) => sum + tx.amount, 0);

            // 5. Total Returns (by 30 Oct 2026)
            const cutoffDate = new Date('2026-10-30');
            const totalReturns2026 = transactions
                .filter(tx =>
                    tx.description === 'Interest Income' &&
                    tx.amount > 0 &&
                    ['pp5', 'pp10', 'pp15'].includes(tx.accountId) &&
                    new Date(tx.date) <= cutoffDate
                )
                .reduce((sum, tx) => sum + tx.amount, 0);

            // 6. Further Returns (After 30 Oct 2026)
            const furtherReturns = transactions
                .filter(tx =>
                    tx.description === 'Interest Income' &&
                    tx.amount > 0 &&
                    ['pp5', 'pp10', 'pp15'].includes(tx.accountId) &&
                    new Date(tx.date) > cutoffDate
                )
                .reduce((sum, tx) => sum + tx.amount, 0);

            // Update DOM
            const format = (amt) => amt.toLocaleString('en-IN', { style: 'currency', currency: 'INR' });

            document.getElementById('investedAmount').innerText = format(investedAmount);
            document.getElementById('returns5').innerText = format(returns5);
            document.getElementById('returns10').innerText = format(returns10);
            document.getElementById('returns15').innerText = format(returns15);
            document.getElementById('totalReturns2026').innerText = format(totalReturns2026);
            document.getElementById('furtherReturns').innerText = format(furtherReturns);
        });
    </script>
</body>

</html>